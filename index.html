<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La Torre del Conocimiento 2.0</title>
    <style>
        :root {
            --primary-color: #4CAF50; /* Verde Primaria */
            --secondary-color: #673AB7; /* Morado Secundaria */
            --bg-color: #f0f2f5;
            --card-bg: #ffffff;
            --timer-color: #FF9800;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }

        .game-container {
            background-color: var(--card-bg);
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 650px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        h1 { color: #2c3e50; margin-top: 0; }
        h2 { color: #34495e; font-size: 1.4rem; }

        /* Botones Generales */
        .btn {
            padding: 15px 25px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin: 10px;
            font-weight: bold;
            color: white;
            display: inline-block;
        }
        .btn:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .btn-primaria { background-color: var(--primary-color); width: 100%; max-width: 300px; }
        .btn-secundaria { background-color: var(--secondary-color); width: 100%; max-width: 300px; }
        
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }
        .btn-opcion {
            background-color: #2196F3;
            padding: 20px;
            font-size: 1.2rem;
        }

        /* Feedback y Explicaci√≥n */
        .feedback-container {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            background-color: #f8f9fa;
            border: 2px solid #ddd;
            display: none; /* Oculto por defecto */
        }
        .explanation-text {
            color: #555;
            font-style: italic;
            margin: 10px 0;
        }
        .btn-next {
            background-color: #333;
            padding: 10px 30px;
        }

        /* Barra de Tiempo (Solo Secundaria) */
        #timer-container {
            width: 100%;
            height: 10px;
            background-color: #ddd;
            margin-bottom: 20px;
            border-radius: 5px;
            display: none;
            overflow: hidden;
        }
        #timer-bar {
            height: 100%;
            width: 100%;
            background-color: var(--timer-color);
            transition: width 1s linear;
        }

        /* Estados */
        .screen { display: none; }
        .active { display: block; }
        .stats-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-weight: bold;
            color: #555;
        }
        .tag {
            background: #eee;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.85rem;
        }

    </style>
</head>
<body>

<div class="game-container">
    
    <div id="start-screen" class="screen active">
        <h1>üéì Torre del Saber</h1>
        <p>Elige tu nivel acad√©mico:</p>
        
        <button class="btn btn-primaria" onclick="startGame('primaria')">
            üéí PRIMARIA<br>
            <small>Sin tiempo l√≠mite. Aprende paso a paso.</small>
        </button>
        <br>
        <button class="btn btn-secundaria" onclick="startGame('secundaria')">
            üöÄ SECUNDARIA<br>
            <small>‚è±Ô∏è Modo Contrarreloj activado</small>
        </button>
    </div>

    <div id="game-screen" class="screen">
        <div id="timer-container"><div id="timer-bar"></div></div>

        <div class="stats-bar">
            <span class="tag" id="level-tag">Nivel 1</span>
            <span>Puntos: <span id="score">0</span></span>
            <span>Vidas: <span id="lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span></span>
        </div>

        <h2 id="question">Pregunta...</h2>

        <div id="options-container" class="options-grid">
            </div>

        <div id="feedback-area" class="feedback-container">
            <h3 id="feedback-title"></h3>
            <p id="explanation-text" class="explanation-text"></p>
            <button class="btn btn-next" onclick="nextQuestion()">Continuar ‚û°Ô∏è</button>
        </div>
    </div>

    <div id="end-screen" class="screen">
        <h1 id="end-title">Fin del Juego</h1>
        <p id="end-msg">Resumen...</p>
        <button class="btn" style="background-color: #333;" onclick="location.reload()">Volver al Men√∫</button>
    </div>

</div>

<script>
    // --- BASE DE DATOS AMPLIADA ---
    const database = {
        primaria: [
            { q: "5 + 3 + 2 =", options: ["9", "10", "11", "8"], a: 1, expl: "Sumamos en orden: 5+3 es 8, y 8+2 es 10." },
            { q: "¬øCu√°ntos lados tiene un pent√°gono?", options: ["4", "5", "6", "8"], a: 1, expl: "La ra√≠z 'Penta' significa cinco. Un cuadrado tiene 4, un hex√°gono 6." },
            { q: "8 x 4 =", options: ["32", "28", "36", "24"], a: 0, expl: "Sumar 8 cuatro veces (8+8+8+8) nos da 32." },
            { q: "¬øQu√© n√∫mero falta? 2, 4, 6, __, 10", options: ["7", "9", "8", "12"], a: 2, expl: "Es una serie que va de 2 en 2 (n√∫meros pares)." },
            { q: "Si tienes 10 manzanas y regalas la mitad, ¬øcu√°ntas te quedan?", options: ["2", "4", "5", "6"], a: 2, expl: "La mitad de 10 se calcula dividiendo 10 entre 2, que es 5." },
            { q: "30 √∑ 5 =", options: ["5", "6", "7", "4"], a: 1, expl: "Porque 6 multiplicado por 5 da 30." },
            { q: "¬øCu√°l fracci√≥n es m√°s grande?", options: ["1/2", "1/4", "1/8", "1/3"], a: 0, expl: "Imagina un pastel. 1/2 es la mitad del pastel, es el trozo m√°s grande." },
            { q: "√Årea de un cuadrado de lado 5cm:", options: ["20cm¬≤", "10cm¬≤", "25cm¬≤", "15cm¬≤"], a: 2, expl: "El √°rea de un cuadrado es lado por lado (5 x 5 = 25)." }
        ],
        secundaria: [
            { q: "(-5) + (-3) =", options: ["-8", "8", "-2", "2"], a: 0, expl: "Signos iguales se suman y se mantiene el signo. Debes 5 y debes 3, en total debes 8." },
            { q: "En la ecuaci√≥n 2x = 10, x vale:", options: ["20", "5", "8", "12"], a: 1, expl: "Para despejar x, el 2 que multiplica pasa dividiendo: 10 √∑ 2 = 5." },
            { q: "3 + 2 x 4 =", options: ["20", "11", "14", "24"], a: 1, expl: "Jerarqu√≠a de operaciones: Primero multiplicamos (2x4=8) y luego sumamos (3+8=11)." },
            { q: "El 25% de 200 es:", options: ["25", "100", "50", "75"], a: 2, expl: "25% es la cuarta parte. 200 dividido entre 4 es 50." },
            { q: "Si x + 5 = 2x, ¬øcu√°nto vale x?", options: ["5", "-5", "0", "1"], a: 0, expl: "Restamos x a ambos lados: 5 = 2x - x, por lo tanto 5 = x." },
            { q: "√Årea de un tri√°ngulo de base 4 y altura 3:", options: ["12", "6", "7", "10"], a: 1, expl: "La f√≥rmula es (base x altura) / 2. (4x3)/2 = 12/2 = 6." },
            { q: "Ra√≠z cuadrada de 144:", options: ["10", "11", "12", "14"], a: 2, expl: "Porque 12 x 12 es igual a 144." },
            { q: "Probabilidad de sacar cara en una moneda:", options: ["10%", "25%", "50%", "100%"], a: 2, expl: "Hay 2 opciones (cara o cruz), tienes 1 de 2 oportunidades (1/2 = 50%)." }
        ]
    };

    // --- VARIABLES DE ESTADO ---
    let currentMode = '';
    let questions = [];
    let qIndex = 0;
    let score = 0;
    let lives = 3;
    let timerInterval;
    let timeLeft = 0;
    let maxTime = 15; // Segundos por pregunta en secundaria

    // --- L√ìGICA DEL JUEGO ---
    function startGame(mode) {
        currentMode = mode;
        questions = database[mode];
        qIndex = 0;
        score = 0;
        lives = 3;
        
        // Configuraci√≥n UI
        document.getElementById('start-screen').classList.remove('active');
        document.getElementById('game-screen').classList.add('active');
        
        // Mostrar/Ocultar temporizador
        const timerContainer = document.getElementById('timer-container');
        if (mode === 'secundaria') {
            timerContainer.style.display = 'block';
        } else {
            timerContainer.style.display = 'none';
        }

        updateStats();
        loadQuestion();
    }

    function loadQuestion() {
        if (qIndex >= questions.length) {
            endGame(true);
            return;
        }

        // Resetear UI de pregunta
        const qData = questions[qIndex];
        document.getElementById('question').innerText = qData.q;
        document.getElementById('level-tag').innerText = `Nivel ${qIndex + 1}`;
        document.getElementById('feedback-area').style.display = 'none';
        document.getElementById('options-container').style.display = 'grid'; // Mostrar opciones

        // Generar botones
        const container = document.getElementById('options-container');
        container.innerHTML = '';
        
        qData.options.forEach((opt, idx) => {
            const btn = document.createElement('button');
            btn.className = 'btn btn-opcion';
            btn.innerText = opt;
            btn.onclick = () => checkAnswer(idx, btn);
            container.appendChild(btn);
        });

        // Iniciar Timer si es Secundaria
        if (currentMode === 'secundaria') {
            startTimer();
        }
    }

    function startTimer() {
        clearInterval(timerInterval);
        timeLeft = maxTime;
        updateTimerBar();

        timerInterval = setInterval(() => {
            timeLeft--;
            updateTimerBar();
            
            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                timeUp();
            }
        }, 1000);
    }

    function updateTimerBar() {
        const percentage = (timeLeft / maxTime) * 100;
        const bar = document.getElementById('timer-bar');
        bar.style.width = percentage + "%";
        
        // Cambiar color a rojo si queda poco
        if(percentage < 30) bar.style.backgroundColor = "#F44336";
        else bar.style.backgroundColor = "#FF9800";
    }

    function timeUp() {
        // Simular respuesta incorrecta por tiempo
        lives--;
        updateStats();
        showFeedback(false, "‚è∞ ¬°Se acab√≥ el tiempo!", questions[qIndex].expl);
    }

    function checkAnswer(selectedIdx, btnElement) {
        clearInterval(timerInterval); // Parar el reloj
        
        const qData = questions[qIndex];
        const isCorrect = selectedIdx === qData.a;

        if (isCorrect) {
            score += 100 + (timeLeft * 10); // Bonus por velocidad
            btnElement.style.backgroundColor = "#4CAF50";
        } else {
            lives--;
            btnElement.style.backgroundColor = "#F44336";
            // Marcar la correcta visualmente tambi√©n
            const correctBtn = document.querySelectorAll('.btn-opcion')[qData.a];
            correctBtn.style.backgroundColor = "#81C784"; 
        }

        updateStats();
        showFeedback(isCorrect, isCorrect ? "¬°Correcto!" : "Incorrecto", qData.expl);
    }

    function showFeedback(success, title, explanation) {
        // Deshabilitar botones
        const btns = document.querySelectorAll('.btn-opcion');
        btns.forEach(b => b.disabled = true);

        const fbArea = document.getElementById('feedback-area');
        const fbTitle = document.getElementById('feedback-title');
        const fbText = document.getElementById('explanation-text');

        fbArea.style.display = 'block';
        fbArea.style.borderColor = success ? "#4CAF50" : "#F44336";
        fbTitle.innerText = title;
        fbTitle.style.color = success ? "#2E7D32" : "#C62828";
        fbText.innerText = "üí° " + explanation;

        if (lives <= 0) {
            document.querySelector('.btn-next').innerText = "Ver Resultado Final";
        } else {
            document.querySelector('.btn-next').innerText = "Continuar ‚û°Ô∏è";
        }
    }

    function nextQuestion() {
        if (lives <= 0) {
            endGame(false);
        } else {
            qIndex++;
            loadQuestion();
        }
    }

    function updateStats() {
        document.getElementById('score').innerText = score;
        let hearts = "";
        for(let i=0; i<lives; i++) hearts += "‚ù§Ô∏è ";
        document.getElementById('lives').innerText = hearts || "üíÄ";
    }

    function endGame(victory) {
        clearInterval(timerInterval);
        document.getElementById('game-screen').classList.remove('active');
        document.getElementById('end-screen').classList.add('active');
        
        const title = document.getElementById('end-title');
        const msg = document.getElementById('end-msg');

        if (victory) {
            title.innerText = "¬°Misi√≥n Cumplida! üèÜ";
            title.style.color = "#4CAF50";
            msg.innerHTML = `Completaste el nivel ${currentMode.toUpperCase()}.<br>Puntuaci√≥n Final: <b>${score}</b>`;
        } else {
            title.innerText = "Game Over üíÄ";
            title.style.color = "#F44336";
            msg.innerHTML = `Te quedaste sin vidas.<br>Llegaste hasta el nivel ${qIndex + 1}.<br>Puntuaci√≥n: <b>${score}</b>`;
        }
    }

</script>

</body>
</html>